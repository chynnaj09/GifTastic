$(document).ready(function () {

    var topics = [
        "The Office",
        "Unbreakable Kimmy Schmidt",
        "Santa Clarita Diet",
        "Luke Cage",
        "Scrubs",
        "Orange Is the New Black",
        "Master of None",
        "Queer Eye",
        "Dave Chappelle",

    ];


    function displayGif() {

        var topic = $(this).attr("data-name");
        var queryURL = "https://api.giphy.com/v1/gifs/search?q=" + topic + "&api_key=1mduF6WdOT5Q8wMQO9uufvzNpoKWBzCy&limit10";
        
        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(function (response) {
           
            $('.gifGoesHere').empty();

            for (var i = 0; i < response.data.length; i++) {
                // Variables to add HTML elements and standardize images generated by buttons
                var gifDiv = $('<div class="gifDiv">');
                var rating = response.data[i].rating;
                var ratingDiv = $('<p>').html("Rating: " + rating);
                var animated = response.data[i].images.fixed_height.url;
                var still = response.data[i].images.fixed_height_still.url;
                var gifImg = $('<img class="gImage">');

                // Defaulting gifs to still
                gifImg.attr('src', still);
                gifImg.attr('data-still', still);
                gifImg.attr('data-animate', animated);
                gifImg.attr('data-state', 'still')

                // Securing ratings appear after their respective gifs
                gifDiv.append(ratingDiv);
                gifDiv.prepend(gifImg);
                $('.gifGoesHere').prepend(gifDiv);
            }
        });
    };

    // Onclick function to animate/pause gifs
    $('.gifGoesHere').on("click", ".gImage", function () {

        var state = $(this).attr('data-state');
        // If state = still, on click will animate the gif
        if (state == 'still') {
            $(this).attr('src', $(this).data('animate'));
            $(this).attr('data-state', 'animate');
        }
        // Otherwise, if state != still, gif will pause on click   
        else {
            $(this).attr('src', $(this).data('still'));
            $(this).attr('data-state', 'still');
        }
    });

    // New buttons function
    function renderButtons() {
        $(".buttons-original").empty();
        // Verifying buttons
        for (var i = 0; i < topics.length; i++) {
            let addButton = $('<button class="button">');
            addButton.addClass("shows");
            addButton.attr("data-name", topics[i]);
            addButton.html(topics[i]);

            // Appends new buttons to the end of the list of existing buttons
            $(".buttons-original").append(addButton);
        }
    };

    // New button created when field has a value entered and then cleared after confirming
    $(".add-gif").on("click", function (event) {
        event.preventDefault();
        var gifs = $(".gif-name").val().trim();
        topic.push(gifs);
        $(".gif-name").val("");
        renderButtons();
    });

    // Calls the buttons to be created in the class 'pokemon'
    $(document).on("click", ".shows", displayGif);
    renderButtons();
});